<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lessons - CareSim Student Portal</title>
    <link rel="icon" type="image/png" sizes="32x32" href="asat.png">
    <link rel="icon" type="image/png" sizes="16x16" href="asat.png">
    <link rel="shortcut icon" type="image/png" href="asat.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="student-portal.css">
    <!-- Model Viewer for 3D Tools -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body class="student-portal">
    <!-- Header / Navigation -->
    <header class="portal-header">
        <div class="header-content">
            <div class="logo">
                <a class="logo-link" href="/student-dashboard">
                    <img src="caresimm.png" alt="CareSim" class="header-logo">
                </a>
            </div>
            <div class="header-right">
                <nav class="nav-tabs">
                    <a href="/student-dashboard" class="nav-tab">Dashboard</a>
                    <a href="/student-lessons" class="nav-tab active">Lessons</a>
                    <a href="/student-progress" class="nav-tab">Progress</a>
                    <a href="/student-class" class="nav-tab">Class</a>
                    <a href="/student-certificates" class="nav-tab">Certificates</a>
                    <a href="/student-profile" class="nav-tab">Profile</a>
                </nav>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>

    <div class="portal-container lessons-page-container">
        <!-- Left Panel: Lesson List -->
        <aside class="lessons-list-panel">
            <div class="lessons-list-header">
                <h2>Lessons</h2>
                <p class="lessons-subtitle">View and track your available lessons.</p>
                
                <!-- View Mode Switcher -->
                <div class="view-mode-switcher">
                    <button class="view-mode-btn active" data-mode="lessons" onclick="switchViewMode('lessons')">
                        <i class="fas fa-book"></i> Lessons
                    </button>
                    <button class="view-mode-btn" data-mode="videos" onclick="switchViewMode('videos')">
                        <i class="fas fa-video"></i> Videos
                    </button>
                    <button class="view-mode-btn" data-mode="tools" onclick="switchViewMode('tools')">
                        <i class="fas fa-tools"></i> Tools
                    </button>
                </div>
                
                <div class="lessons-progress-indicator" id="lessonsProgressIndicator">
                    <div class="lessons-progress-bar">
                        <div class="lessons-progress-fill" id="lessonsProgressFill" style="width: 0%"></div>
                    </div>
                    <span class="lessons-progress-text" id="lessonsProgressText">0 of 6 completed</span>
                </div>
            </div>
            <div class="lessons-list" id="lessonsList">
                <!-- Lesson cards will be inserted here -->
            </div>
        </aside>

        <!-- Right Panel: Lesson Viewer -->
        <main class="lesson-viewer-panel">
            <div id="emptyState" class="empty-lesson-state">
                <div class="empty-state-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 19.5C4 18.395 4.895 17.5 6 17.5H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 2H20V22H6V2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 7H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 12H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h3>Select a lesson to begin</h3>
                <p>Choose a lesson from the list on the left to view its content and tools.</p>
            </div>

            <div id="lessonViewer" class="lesson-viewer" style="display: none;">
                <!-- Breadcrumb -->
                <nav class="lesson-breadcrumb">
                    <a href="/student-dashboard">Dashboard</a>
                    <span class="breadcrumb-separator">/</span>
                    <span>Lessons</span>
                    <span class="breadcrumb-separator">/</span>
                    <span id="breadcrumbLessonName">Lesson</span>
                </nav>

                <!-- Content Area (for Lessons view) -->
                <div id="lessonsContentView" class="lessons-content-view">
                    <!-- Content Mode: Page content + Take Assessment panel -->
                    <div id="pageContentView">
                        <!-- Content will be dynamically inserted here (intro view or page view) -->
                    </div>
                    
                    <!-- Assessment Mode: Questions + Result Summary -->
                    <div id="pageAssessmentView" style="display: none;">
                        <div id="assessmentsContainer" class="assessments-container">
                            <!-- Assessment form will be rendered here -->
                        </div>
                        <!-- Page-level assessment result + actions (assessment mode) -->
                        <div id="pageAssessmentResultContainer"></div>
                    </div>
                </div>

                <!-- Videos View -->
                <div id="videosView" class="videos-view" style="display: none;">
                    <!-- Videos content will be inserted here -->
                    </div>

                <!-- Tools View -->
                <div id="toolsView" class="tools-view" style="display: none;">
                    <!-- Tools content will be inserted here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Tool Details Modal -->
    <div id="toolModal" class="history-modal" style="display: none;">
        <div class="history-modal-content tool-modal-content">
            <div class="history-modal-header">
                <h2 id="toolModalTitle">Tool Name</h2>
                <button class="history-close" onclick="closeToolModal()">&times;</button>
            </div>
            <div class="tool-modal-body">
                <div class="tool-modal-tabs">
                    <button class="tool-modal-tab active" data-tab="image" onclick="switchToolModalTab('image')">Image</button>
                    <button class="tool-modal-tab" data-tab="3d" onclick="switchToolModalTab('3d')">3D View</button>
                </div>
                <div class="tool-modal-content-area">
                    <div id="toolImageTab" class="tool-modal-tab-content active">
                        <div class="tool-image-container">
                            <img id="toolModalImage" src="" alt="Tool image" />
                        </div>
                    </div>
                    <div id="tool3DTab" class="tool-modal-tab-content">
                        <div id="tool3DViewerContainer" style="width: 100%; height: 500px; background: #F8FAFC; border-radius: 8px; overflow: hidden;"></div>
                    </div>
                </div>
                <div class="tool-modal-info">
                    <div class="tool-info-section">
                        <h3>Description</h3>
                        <p id="toolModalDescription">Tool description will appear here.</p>
                    </div>
                    <div class="tool-info-section">
                        <h3>Purpose</h3>
                        <p id="toolModalPurpose">Tool purpose will appear here.</p>
                    </div>
                    <div class="tool-info-section">
                        <h3>Steps to Use</h3>
                        <ol id="toolModalSteps">
                            <!-- Steps will be inserted here -->
                        </ol>
                    </div>
                    <div class="tool-info-section">
                        <p class="tool-used-in">
                            <strong>Used in:</strong> <span id="toolModalLessonName">Lesson Name</span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-actions" style="padding: 20px 24px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 12px;">
                <button type="button" class="btn-primary" onclick="closeToolModal()" style="padding: 10px 20px; background: #C19A6B; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;">Close</button>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="history-modal" style="display: none;">
        <div class="history-modal-content logout-modal-content">
            <div class="history-modal-header">
                <h2>Confirm Logout</h2>
                <button class="history-close" onclick="closeLogoutModal()">&times;</button>
            </div>
            <div class="logout-modal-body">
                <p>Are you sure you want to log out?</p>
            </div>
            <div class="modal-actions" style="padding: 20px 24px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 12px;">
                <button type="button" class="btn-secondary" onclick="closeLogoutModal()" style="padding: 10px 20px; background: white; color: #64748B; border: 1px solid #E2E8F0; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;">Cancel</button>
                <button type="button" class="btn-primary" onclick="confirmLogout()" style="padding: 10px 20px; background: #C19A6B; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;">Logout</button>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="history-modal" style="display: none;">
        <div class="history-modal-content">
            <div class="history-modal-header">
                <h2 id="alertTitle">Notice</h2>
                <button class="history-close" onclick="closeAlertModal()">&times;</button>
            </div>
            <div class="history-modal-body">
                <p id="alertMessage"></p>
            </div>
            <div class="modal-actions" style="padding: 20px 24px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 12px;">
                <button type="button" class="btn-primary" onclick="closeAlertModal()" style="padding: 10px 20px; background: #C19A6B; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;">OK</button>
            </div>
        </div>
    </div>

    <!-- Student lessons logic -->
    <script src="/js/student-lessons.js"></script>

    <!-- Assessment Result Modal -->
    <div id="assessmentResultModal" class="modal-overlay" style="display:none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="assessmentResultTitle">Assessment Result</h2>
                <button class="modal-close" onclick="closeAssessmentResultModal()">&times;</button>
            </div>
            <div class="modal-body" id="assessmentResultBody">
                <!-- JS will render attempt details here -->
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="assessmentRetakeButton">Retake Assessment</button>
            </div>
        </div>
    </div>
</body>
</html>
